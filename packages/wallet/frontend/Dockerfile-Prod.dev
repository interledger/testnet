FROM node:lts-slim

# Set the working directory
WORKDIR /home/testnet

RUN apt-get update && \
    apt-get install -y python3 build-essential && \
    apt-get clean

# Install PNPM
RUN corepack enable
RUN corepack prepare pnpm@8.6.2 --activate

# Copy lockfile, NVM and NPM configuration to the working directory
COPY pnpm-lock.yaml .nvmrc .npmrc ./

# Fetch packages from lockfile (https://pnpm.io/cli/fetch#usage-scenario)
RUN pnpm fetch

# Add everything to the working directory
ADD . ./

# Install packages from virtual store
RUN pnpm install -r --offline

ENV NEXT_PUBLIC_BACKEND_URL=https://api.rafiki.money
ENV NEXT_PUBLIC_OPEN_PAYMENTS_HOST=https://ilp.rafiki.money

RUN pnpm wallet:frontend build

<<<<<<< HEAD:packages/wallet-frontend/Dockerfile-Prod.dev
CMD ["pnpm", "wallet-frontend", "start"]
=======
CMD ["pnpm", "wallet:frontend", "start"]
>>>>>>> c5e9bd332ccc0a11b3ad0cd2b2aba7fccbdd6cfd:packages/wallet/frontend/Dockerfile-Prod.dev
